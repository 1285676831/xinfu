<!DOCTYPE html>
<html>
<head>
${inc:/action/project/fitness/home/pub}
<link rel="stylesheet" href="${def:context}/js/project/fitness/css/contract2.css" />
<title>活动列表</title>
</head>
<body >


	<div class="modal fade" id="modalAddnew"  tabindex="-1" style='display:none;'>
		<div class="basic-information modal-dialog dialogbg"  style="width:1020px">
				<header class="header-default">
					<span id="formTitle"></span>
					<span class="header-close"></span>
				</header>
					<form id="messageForm" name="messageForm" method="post">
							<input type="hidden" id="tuid" name="tuid">
							<input name="status"  id="status"  type="hidden" value="" preserve="true" />
	<!--创建活动-->
	<div class="am-tabs r-tab-container createaAtivity" data-am-tabs="{noSwipe: 1}"style="width:1020px">
					<nav class="am-tabs-nav am-nav am-nav-tabs r-tab">
						<li class="am-active">
							<a class="three-none" href="#ca-tab1">首页</a>
						</li>
						<li>
							<a class="three-none" href="#ca-tab2">报名页面</a>
						</li>
						<li>
							<a class="three-none" href="#ca-tab3">参赛详情</a>
						</li>
						<li>
							<a class="three-none" href="#ca-tab4">排行榜</a>
						</li>
						<li>
							<a class="three-none" href="#ca-tab5">活动说明</a>
						</li>
					</nav>
					<div class="am-tabs-bd r-tab-cont">
						<div class="eb-left fl ca-tab-cout-1 am-tab-panel am-in am-active am-fade three-none" id="ca-tab1">
							<img src="${def:context}/js/project/fitness/image/img-activity.png" >
						</div>
						<div class="eb-left fl ca-tab-cout-2 am-tab-panel am-fade three-none" id="ca-tab2">
							<img src="${def:context}/js/project/fitness/image/img-activity2.png" >
						</div>
						<div class="eb-left fl ca-tab-cout-3 am-tab-panel am-fade three-none" id="ca-tab3">
							<img src="${def:context}/js/project/fitness/image/img-activity3.png" >
						</div>
						<div class="eb-left fl ca-tab-cout-4 am-tab-panel am-fade three-none" id="ca-tab4">
							<img src="${def:context}/js/project/fitness/image/img-activity4.png" >
						</div>
						<div class="eb-left fl ca-tab-cout-5 am-tab-panel am-fade three-none" id="ca-tab5">
							<img src="${def:context}/js/project/fitness/image/img-activity5.png" >
						</div>
						<div class="eb-right fl am-tabs r-tab-container"  style="width:629px">
								<nav class="am-tabs-nav am-nav am-nav-tabs r-tab">
									<li class="am-active">
										<a class="three-none" href="#crea-tab1">基础设置</a>
									</li>
									<li>
										<a class="three-none" href="#crea-tab2">报名设置</a>
									</li>
									<li>
										<a class="three-none" href="#crea-tab3">分享设置</a>
									</li>
								</nav>
								<div class="am-tabs-bd r-tab-cont">
									<div class="crea-tab-cout-1 am-tab-panel am-in am-active am-fade" id="crea-tab1">
										<ul class="form-ul">
											<li class="clearlr">
												<label class="label-left fl">投票时间：</label>
												<input type="text" value="${def:date}" class="fl time-input-1" id="startdate" name="startdate" preserve="true" >
												<span class="fl bar">-</span>
												<input type="text" value="${def:date}" class="fl time-input-2"id="enddate" name="enddate" preserve="true" >
											</li>
											<li class="clearlr">
												<label class="label-left fl">投票形式：</label>
												<div class="fl" style="margin-top: 6px">
														<input type="radio" value="0"  name="votetype">每日均可投票
														<input type="radio" value="1"   name="votetype"  >一次性投票
													<div class="brief">可为<input type="text" value="5" id="votenum" name="votenum" >名选手投票</div>
												<!-- 	<div class="desc" id="toupiaoinfo">每日均可投票	</div> -->
												</div>
											</li>
											<li>
												<label class="label-left">投票须知：</label>
												<textarea id="campaignrules" name="campaignrules"></textarea>
											</li>
											<li>
												<label class="label-left" >活动标题：</label>
												<input type="text" placeholder="最多可输入10个字符"  class="activity-title" id="campaign_name" name="campaign_name">
											</li>
									<!-- 		<li>
												<label class="label-left">虚拟报名人数：</label>
												<input type="text" class="">人
											</li>
											<li>
												<label class="label-left">虚拟累计票数：</label>
												<input type="text" class="">票
											</li> -->
											<li>
												<label class="label-left">活动介绍：</label>
												<textarea class="activity-brief" id="remark" name="remark"></textarea>
											</li>
											<li>
												<label class="label-left">主办单位：</label>
												<input type="text"  class="host-unit" value="${fld:org_name}"readonly="readonly" preserve="true" >
											</li>
										</ul>
									</div>
									<div class="crea-tab-cout-2 am-tab-panel am-fade" id="crea-tab2">
										<ul class="form-ul">
											<li class="clearlr">
												<label class="label-left fl">报名时间：</label>
												<input type="text" value="${def:date}" class="fl time-input-1" id="enrollfdate" name="enrollfdate" preserve="true" >
												<span class="fl bar">-</span>
												<input type="text" value="${def:date}" class="fl time-input-2" id="enrolltdate" name="enrolltdate" preserve="true" >
											</li>
											<li>
												<label class="label-left">报名须知：</label>
												<textarea class="activity-brief" id="voteremark" name="voteremark"></textarea>
											</li>
											<li class="clearlr">
												<label class="label-left fl">报名人数限制：</label>
												<div class="fl">
														<input type="radio" value="0"   name="totalnumRadio">不限
														<input type="radio" value="1"  name="totalnumRadio" >限制
														<input type="text" value=""  id="totalnum" name="totalnum" readonly="readonly" >人
												</div>
											</li>
										</ul>
									</div>
									<div class="crea-tab-cout-3 am-tab-panel am-fade" id="crea-tab3">
										<ul class="form-ul">
											<li class="clearlr">
												<label class="label-left fl">微博分享图标：</label>
												<div class="fl" style="margin-top: 6px">
														<input type="radio" value="0" name="logoidRadio">默认
														<input type="radio" value="1" name="logoidRadio">自定义
														<input type="hidden" value="" name="logoid" id="logoid">
												</div>
											</li>
											<li>
												<div class="upload-div clearlr">
													<div class="img-div fl">
														<img src="${def:context}/js/project/fitness/image/btn-default-upload-img.png" class="upload-img">
													</div>
													<button class="btn-upload" id="upload_btn"></button>
													<label class="desc">请上传5M 以内，格式为 JPG、BMP、PNG、GIF 的图片</label>
												</div>
											
											</li>
										</ul>
									</div>
								</div>
							</div>
					</div>
				</div>




					
				<footer class="footer-default">
					<button id="save_btn" type="button">保存</button>
				</footer>
				</form>
			</div>
		</div>

	<form  role="form" method="post" id="searchForm">
				<input name="sort" type="hidden" value="code" preserve="true" />
				<input name="order" type="hidden" value="desc" preserve="true" />
				<input name="pageNo" type="hidden" value="" preserve="true" />
				<input name="totalPages" type="hidden" value="" preserve="true" />
	
			<input name="status"  id="status"  type="hidden" value="" preserve="true" />
				<div class="am-tabs-bd r-tab-cont">
					<div class="c-n-nav-2 am-tab-panel am-in am-active am-fade three-none" >
						<div class="tab-cout-nav">
							<div class="tab-cout-nav-t">
								<nav class="tab-nav-my">
									<li>
										<input type="text" id="s_name" name="s_name" placeholder="请输入活动名称" class="input-default"/>							
					 			 	</li>				
					 			 	
					 			 	<li>
										 <div class="my-selected">			 	
										 	<select id="s_status" name="s_status" style="display: none;"> 
												<option value="">全部状态</option>
												<option value="0">无效</option>
												<option value="1">已启用</option>
												<option value="2">未启用</option>
											</select>
										 </div>		 	
					 			 	</li>	
									<div class="r-c-btnList">
										<button type="button" class="r-c-3-btn-1" id="search_btn"></button>
										<img src="${def:context}/js/project/fitness/image/SVG/nav/xinzengkecheng.svg" alt="" data-toggle="modal" id="addnew_btn">
									</div>
								</nav>
							</div>
							<div class="tab-cout-nav-b">
								<nav class="r-c-3-t-b-l">
									
								</nav>
								<nav class="r-c-3-t-b-r">
									 <li>
										<img src="${def:context}/js/project/fitness/image/SVG/nav/yulan.svg" title='查看' alt="" id="see_btn">
									</li>
									<li>
										<img src="${def:context}/js/project/fitness/image/SVG/btn/kaiqi.svg" title='启用' alt="" id="start_btn">
									</li>
							    	 <li>
										<img src="${def:context}/js/project/fitness/image/SVG/btn/jinyong.svg" title='禁用' alt="" id="disable_btn">
									</li>	
									 <li>
											<img src="${def:context}/js/project/fitness/image/SVG/nav/xiugai.svg" alt=""id="edit_btn">
									</li>
									<li>
											<img src="${def:context}/js/project/fitness/image/SVG/nav/shanchu.svg" alt=""id="delete_btn">
									</li>	
								</nav>
							</div>
						</div>
				<div class="r-tab-cout-3-b">
							<div class="to-change-background"></div>
							<table> 
								<thead>
									<tr>
										<th class="table-checkbox">
											<label class="am-checkbox">
												<input id="selectAll"  name="datalist"  type="checkbox" value="" style="display: none;">
											</label>
										</th>
										<th>活动名称</th>
										<th>投票形式</th>
										<th>可报名人数</th>
										<th>活动状态</th>
									</tr>
								</thead>
								
								<tbody id="datagridTemplate" style="display: none">
									<tr>
										 <td class="table-checkbox">#application_id#</td> 
										<td >#campaign_name#</td>
										<td >#votetype#</td>
										<td >#totalnum#</td>
										<td >#status#</td>		
									</tr>
								</tbody>
								<tbody id="datagrid">
								</tbody>
							</table>
							<div class="pageDiv">
								<ul class="pagination">
								</ul>
							</div>
						</div>
					</div>
				</div>
			</form>

	<input type="hidden" name="actionroot" id="actionroot" value="${def:actionroot}" />
	<script language="JavaScript">
	var search=null;
$(document).ready(function() {
	searchSelectInit($("#s_status"));
	$(".header-close").unbind().on("click",function(){
		$("#modalAddnew").modal('hide');
		ccms.util.clearForm('messageForm');
	});
	
	$Dialog().date($('#startdate'));
	$Dialog().date($('#enddate'));
	$Dialog().date($('#enrollfdate'));
	$Dialog().date($('#enrolltdate'));
	//批量启用
	$("#start_btn").unbind().on("click",function(){
		updateStatus(1);
	});
	//批量禁用
	$("#disable_btn").unbind().on("click",function(){
		updateStatus(2);
	}); 
	
	$("input[name=totalnumRadio]:eq(0)").on("ifClicked",function () {     
		$('#totalnum').val('');
		$('#totalnum').attr('readonly',true);
	});
	
	$("input[name=totalnumRadio]:eq(1)").on("ifClicked",function () {     
		$('#totalnum').attr('readonly',false);
	});
	
	$("#upload_btn").unbind().on("click",function(){
		var url = '${def:context}/action/project/fitness/attachment/crud?table_code=hr_org_banner&pk_value=';
		ccms.dialog.open({url : url, id : "uploadbanner",height:500,width:600});
	});
	
	
	var obj = $Crud({
		formId:"messageForm",
		button:"save_btn",
		bpkField:"tuid",
		insertBack:function(){
			search.searchData();
		},
		updateBack:function(){
			search.searchData();
		},
		deleteBack:function(){
			search.searchData();
		},
		addNewBack:function(){
			$('input[name=votetype]:eq(0)').iCheck('check');
			$('input[name=totalnumRadio]:eq(0)').iCheck('check');
			$('input[name=logoidRadio]:eq(0)').iCheck('check');
			$('#save_btn').show();
			$("#formTitle").html("新增");
		},
		editBack:function(){
		},
		validate:function(){
			if($('input[name=logoidRadio]:eq(0)').is(':checked')){
				$("#logoid").val("");
			} 
			
			var flag=$("#messageForm").validate({
			});
			return flag;
		}
	}).init();
	
		this.search=search;
		search=$Search({datagrid:"datagrid",formId:"searchForm",rowpackage:function(obj){
			if(obj.status=="已启用"){
				$('#status').val(1);
			}
	},success:function(){
		ccms.util.renderCheckbox("datalist");
		//全选   取消全选
	    $("#selectAll").unbind().on("ifChecked",function(){    //点击事件未选中
			$('input[name=datalist]').iCheck('check');  //
	    }).on("ifUnchecked",function(){    //点击事件未选中
			$('input[name=datalist]').iCheck('uncheck');  //
	    });
		
	 	$("#edit_btn").unbind().on("click", function(){
			var obthis = getCheckboxValue("datalist");
			var len=$('input[name=datalist]:checked').length
			if(obthis!=""&&len==1){
				ccms.util.clearForm('messageForm');
				$('#formTitle').text('修改');
				$('#save_btn').show();
				obj.edit({id:obthis});
			}else{
				ccms.dialog.notice("请选择一个活动！")
			}
		});	
		$("#see_btn").unbind().on("click", function(){
			var obthis = getCheckboxValue("datalist");
			var len=$('input[name=datalist]:checked').length
			if(obthis!=""&&len==1){
				ccms.util.clearForm('messageForm');
				$('#save_btn').hide();
				obj.edit({id:obthis});
				$('#formTitle').html('查看');
			}else{
				ccms.dialog.notice("请选择一个活动！")
			}
		});	 
		
		
		$("#delete_btn").unbind().on("click", function(){
			var flag=true;
			var obthis = getCheckboxValue("datalist");
			
			var checkObj=$('input[name=datalist]:checked');
				$(checkObj).each(function(){
				if($(this).attr('code')==1){
					flag=false;
				}
			}) 			
			
			if(flag){
				if(obthis!=""){
					$Dialog().confirm("确定要执行此操作吗?", function(){
						obj.del({id:obthis});
					});
				}else{
					ccms.dialog.notice("请选择活动！");
				}
			}else{
				ccms.dialog.notice("不能删除已启用活动！");
			}
		}); 
		
		
		

		
}}).initSearchBtn().searchData(1);
})

  function	updateStatus(num){
	var obthis = getCheckboxValue("datalist");
	var len=$('input[name=datalist]:checked').length
	var obj = $('input[name=datalist]:checked');
	
	if(obthis!=""&&len==1){
		$Dialog().confirm("确定要执行此操作吗?", function(){
			if(num==1){
				if($('#status').val()==1){
					ccms.dialog.notice("同时只能开启一个活动");
					return false;
				}
			}
			
			var url = "${def:context}${def:actionroot}/updatestatus?id="+obthis+"&c_status="+num;
			ajaxCall(url,{
				method: "get",
				progress: true,
				dataType: "script",
				success: function() {
					ccms.dialog.notice("操作成功！");
					search.searchData(1);
				}
			});
		});
	}else{
		ccms.dialog.notice("请选一个活动！")
	}
}

function uploadOk(id){
	$("#logoid").val(id);
	$('.upload-img').attr("src","${def:context}/action/ccms/attachment/download?id="+id+"&type=1")
	ccms.dialog.close("uploadbanner");
}
</script>
</body>
</html>