<!DOCTYPE html>
<html>
<head>
${inc:/action/project/fitness/home/pub}
<title>会员卡业务规则</title>
<style type="text/css">
.pl_2{
   margin-left: 10px;
}
.day{
   width:45px;
   text-align:center;
}
.titlecust{
  margin-top: 20px;
}
</style>
</head>
<body >
	<!--addnew/edit form-->
	<div class="modal fade" id="modalAddnew" tabindex="-1" role="dialog" style="display: none;">
  	  <div class="modal-dialog dialogbg" style="width: 800px;height: 200px;">
			<header class="header-default">
					<span id="formTitle">新增</span>
					<button type="button" class="header-close" data-dismiss="modal" aria-hidden="true"></button>
				</header>
				<form id="formEditor" name="formEditor" class="form-horizontal" role="form" method="post">
					<input type="hidden" id="cnfg_id" name="cnfg_id" preserve="true"/>
					<input type="hidden" id="category" name="category" value=""/>
					<input type="hidden" id="crud" name="crud" value=""/>		
	          		<div class="modal-body b-i-main">
						<nav>
							<li>
								<label for="">编号</label>
								<input type="text" placeholder="编号" id="vc_topic" name="vc_topic" value="" maxlength="80"/>			
							</li>
							<li>
								<label for="">赠卡原因</label>
								<input type="text"  placeholder="赠卡原因"  id="vc_content" name="vc_content" value="" maxlength="80" />	
							</li>
						</nav>
					</div>		
				</form>
				<footer class="footer-default">
				  <button type="button" id="save_btn">确&nbsp;定</button>
				</footer>
			</div>
		</div>
	<div class="panel-default col_mainInner">
		<div class="panel-body col_main_body">
		<form id="formedit1" name="formedit1" method="post" action="" class="titlecust">
		    <input type="hidden" id="busyseasonend_id" name="busyseasonend_id" value="${fld:busyseasonend_id}" preserve="true"/>
		    <input type="hidden" id="busyseasonstart_id" name="busyseasonstart_id" value="${fld:busyseasonstart_id}" preserve="true"/>
		    <input type="hidden" id="savecardcost_id" name="savecardcost_id" value="${fld:savecardcost_id}" preserve="true"/>
		    <input type="hidden" id="maxstopmonth_id" name="maxstopmonth_id" value="${fld:maxstopmonth_id}" preserve="true"/>
		    <input type="hidden" id="savecard_id" name="savecard_id" value="${fld:savecard_id}" preserve="true"/>
		    <input type="hidden" id="islimitday_id" name="islimitday_id" value="${fld:islimitday_id}" preserve="true"/>
		    <input type="hidden" id="isstopcarddays_id" name="isstopcarddays_id" value="${fld:isstopcarddays_id}" preserve="true"/>
		    <input type="hidden" id="stopcardmonthfee_id" name="stopcardmonthfee_id" value="${fld:stopcardmonthfee_id}" preserve="true"/>
		    <input type="hidden" id="upgradeaddmoney_id" name="upgradeaddmoney_id" value="${fld:upgradeaddmoney_id}" preserve="true"/>
		    <input type="hidden" id="changememberfee_id" name="changememberfee_id" value="${fld:changememberfee_id}" preserve="true"/>
		    <input type="hidden" id="changemembertype_id" name="changemembertype_id" value="${fld:changemembertype_id}" preserve="true"/>
		    <input type="hidden" id="uplimitday_id" name="uplimitday_id" value="${fld:uplimitday_id}" preserve="true"/>
 		   	<input type="hidden" id="presentreason_id" name="presentreason_id" value="${fld:presentreason_id}" preserve="true"/>
 		   	
		  	<div class="xt-1-div m-t-b-10">
				<label for="ccc" style="color: white;">升级</label>
			</div>
		  	<div class="xt-1-div m-t-b-10 t-l-20">
				<label for="ccc" style="color: white;">在办卡之后的</label>
		    	<input type = "text" value="${fld:uplimitday}" id="uplimitday" name="uplimitday" class = "day input-1"/>
				<span style="color: white;">天内，补差价升级，超过这个天数后，升级要加收费用</span>
			    <input type = "text" value="${fld:upgradeaddmoney}" id="upgradeaddmoney" name="upgradeaddmoney" class = "day input-1"/>
			    <span style="color: white;">元</span>
			</div>
		  	<div class="xt-1-div m-t-b-10">
				<label for="ccc" style="color: white;">转卡</label>
			</div>
		  	<div class="xt-1-div m-t-b-10 hasRadio t-l-20">
				<label for="ccc" style="color: white;">转卡收费类型</label>
		    	<input type = "radio"  name="changemembertype" class = "pl_2" value="0"/><span style="color: white;">固定金额</span>
   	    		<input type = "radio"  name="changemembertype" class = "pl_2" value="1"/><span style="color: white;">按百分</span>
   	    		<input type = "text" style="display:none" id="changememberfee" name="changememberfee" class = "day input-1" value=""/>
   	    		<input type = "text"  style="display:none"  id="changememberfee1" name="changememberfee1" class = "day input-1" value=""/>
				<span style="color: white;" id="zkspan">%</span>
			</div>
		  	<div class="xt-1-div m-t-b-10">
				<label for="ccc" style="color: white;">停卡</label>
			</div>
		  	<div class="xt-1-div m-t-b-10 hasRadio t-l-20">
				<label for="ccc" style="color: white;">每年允许停卡</label>
		    	<input type = "text" value="${fld:maxstopmonth}" id="maxstopmonth" name="maxstopmonth" class = "day input-1"/>
				<span style="color: white;">月，单月停卡费用</span>
		    	<input type = "text" value="${fld:stopcardmonthfee}" id="stopcardmonthfee" name="stopcardmonthfee" class = "day input-1"/>
				<span style="color: white;">元</span>
		    	<input type = "radio" value="1" name="isstopcarddays" class="pl_2"/><span style="color: white;">停卡按天计算</span>
		    	<input type = "radio" value="0" name="isstopcarddays" class="pl_2"/><span style="color: white;">停卡按月计算</span>
			</div>

		  	<div class="xt-1-div m-t-b-10">
				<label for="ccc" style="color: white;">存卡</label>
			</div>
		  	<div class="xt-1-div m-t-b-10 hasRadio t-l-20">
				<label for="ccc" style="color: white;">最小起存天数</label>
		   		<input type = "text" value="${fld:savecard}" id="savecard" name="savecard" class = "day input-1"/>
				<span style="color: white;">天，如不足最小起存天数</span>
   				<input type = "radio"  name="islimitday" class = "pl_2" value="1"/><span style="color: white;">按0天算</span>
   				<input type = "radio"  name="islimitday" class = "pl_2" value="2"/><span style="color: white;">按最小起存天数算</span>
			</div>

		  	<div class="xt-1-div m-t-b-10">
				<label for="ccc" style="color: white;">补卡</label>
			</div>
		  	<div class="xt-1-div m-t-b-10 t-l-20">
				<label for="ccc" style="color: white;">补卡费用</label>
		    	<input type = "text" value="${fld:savecardcost}" id="savecardcost" name="savecardcost" class = "day input-1"/>
				<span style="color: white;">元</span>
			</div>

		  	<div class="xt-1-div m-t-b-10">
				<label for="ccc" style="color: white;">淡旺季卡</label>
			</div>
		  	<div class="xt-1-div m-t-b-10 t-l-20">
				<label for="ccc" style="color: white;">旺季</label>
				<input id="busyseasonstart" name="busyseasonstart" type="text" class="text-center day input-120" value="${fld:busyseasonstart}" readonly/>
				<span style="color: white;">至</span>
				<input id="busyseasonend" name="busyseasonend" type="text" class="text-center day input-120" value="${fld:busyseasonend}" readonly/>
				<span style="color: white;">(淡季卡种在旺季不能使用)</span>
			</div>
    </form></div>
		<div style="margin-top:15px;padding-left: 15px;">
			 <button id="update_btn" type="button"  >确定</button>
	   </div></div>
	<form role="form" method="post" id="searchForm" name="searchForm">
	    <input type="hidden" id="presentreason_id" name="presentreason_id" value="${fld:presentreason_id}" preserve="true"/>
	    <input name="sort" type="hidden" value="vc_fastcode"preserve="true" />
		<input name="order"type="hidden" value="desc" preserve="true" />
		<input name="pageNo" type="hidden" value="" preserve="true" /> 
		<input name="totalPages" type="hidden" value="" preserve="true" />
		<div class="r-tab-cont">
			<div class="c-n-nav-2 am-tab-panel am-in am-active am-fade three-none" >
				<div class="r-tab-cout-3-t">
					<div class="r-tab-cout-3-t-t">
						<nav>
		      				<label class="pl_2" style="color: white;">赠卡原因</label>
						</nav>
					</div>
					<div class="r-tab-cout-3-t-b">
						<nav class="r-c-3-t-b-r">
							<li>
								<button type="button" data-toggle="modal" id="addnew_btn">新增</button>
							</li>
						</nav>
					</div>
				</div>				
			</div>
			<div class="r-tab-cout-3-b">
				<div class="to-change-background"></div>
					<table class="">
						<thead>
							<tr>
								<th>编号</th>
							    <th>赠卡原因</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody id="datagridTemplate" style="display: none" class="pl_2">
							<tr id="list">
							 	<td>#vc_topic_code#</td>
				                <td>#presentreason#</td>
								<td>
									<button class="write edit_btn" code="#presentreason_id#" type="button"></button>
									<button class="delete delete_btn" code="#presentreason_id#" type="button"></button> 
								</td>
							</tr>
						</tbody>
						<tbody id="datagrid">
						</tbody>
					</table>
				<div class="pageDiv">
					<ul class="pagination">
					</ul>
				</div>
			</div>
		</div>
	</form>
		<input type="hidden" name="actionroot" id="actionroot" value="${def:actionroot}" />
<script language="JavaScript">
function queryradiodateturnkind(){
	ccms.util.setCheckboxValue('changemembertype',"${fld:changemembertype}","formedit1");
	
}
function queryradiodatesavecard(){
	ccms.util.setCheckboxValue('islimitday',"${fld:islimitday}","formedit1");
}
function queryradiodateisstopcarddays(){
	ccms.util.setMulitCheckboxValue('isstopcarddays',"${fld:isstopcarddays}","formedit1");
}

function querycengcardbeacause(){
	var search=null;
	var obj = $Crud({
		formId:"formEditor",
		button:"save_btn",
		bpkField:"cnfg_id",
		insertBack:function(){
			search.searchData();
		},
		updateBack:function(){
			search.searchData();
		},
		deleteBack:function(){
			search.searchData();
		},
		addNewBack:function(){
			$("#crud").val("1");
			$("#category").val("PresentReason");
			$("#formTitle").html("新增");
		},
		editBack:function(){
			$("#crud").val("2");
			$("#category").val("PresentReason");
			$("#formTitle").html("修改");
		},
	     validate:function(){
			 var flag=$("#formEditor").validate({
					
		});
			return flag; 
		}, 
		check:function(){
			return true;
		} 
	}).init();
		this.search=search;
		search=$Search({datagrid:"datagrid",formId:"searchForm", success:function(){
		$(".edit_btn").unbind().on("click", function(){
			if($(this).attr("code") != undefined && $(this).attr("code") != ""){
				obj.edit({id:$(this).attr("code")});
				
			}
		});
		$(".delete_btn").unbind().on("click", function(){
			var obthis = $(this);
			$Dialog().confirm("确定要删除该条数据吗?", function(){
				if(obthis.attr("code") != undefined && obthis.attr("code") != ""){
					obj.del({cnfg_id:obthis.attr("code"),category:"PresentReason",crud:"3"});
				}
			});
		});
	}}).initSearchBtn().searchData(1);
}
$(document).ready(function() {
	queryradiodateturnkind();
	queryradiodatesavecard();
	queryradiodateisstopcarddays();

	ccms.util.renderRadio("changemembertype");
	ccms.util.renderRadio("isstopcarddays");
	ccms.util.renderRadio("islimitday");

	if($("input[name=changemembertype]").val()=="1"){  // 20170310 zzn
		$('#zkspan').hide();
		$('#changememberfee,#turnkind1').show();
		$('#changememberfee').val(${fld:changememberfee}); 
	}else{
		$('#zkspan,#changememberfee1,#turnkind2').show();
		$('#changememberfee1').val(${fld:changememberfee}); 
	}
	$("input[name=changemembertype]").on('ifClicked',function(){
	    if($(this).val()=='0'){
			$('#zkspan').hide();
	    	$('#changememberfee,#turnkind1').show();
	    	$('#changememberfee').val("");
	    }else{
	    	$('#changememberfee,#turnkind1').hide();
	    }
	    if($(this).val()=='1'){
			$('#zkspan,#changememberfee1,#turnkind2').show();
	    	$('#changememberfee1').val("");
	    }else{
	    	$('#changememberfee1,#turnkind2').hide();
	    }
	});
	
	$Dialog().monthdate($('#busyseasonstart'),function(){
	});
	$Dialog().monthdate($('#busyseasonend'),function(){
	});
	//操作赠卡原因
	querycengcardbeacause();
	$("#uplimitday").unbind().blur(function(){
		var uplimitday = $("#uplimitday").val();
		if( undefined != uplimitday && "" != uplimitday) {
			if( !isNumber(uplimitday) && Number(uplimitday) < 0 ){
				ccms.dialog.notice("请输入大于等于0的整数");
				$("#uplimitday").val(0);
			}
		}
	});

	$("#update_btn").click(function(){
		var changememberfee = $("#changememberfee").val();
		if(changememberfee==null){
			var changememberfee1 = $("#changememberfee1").val();
			if(changememberfee1==null){
				changememberfee = "0.00";
			}else{
				changememberfee = changememberfee1;
			}
		}
		var uri = "${def:context}${def:actionroot}/updateformdate?";
		//修改参数
		url(uri+"tuid="+$("#busyseasonend_id").val()+"&param_text="+$("#busyseasonend").val());
		url(uri+"tuid="+$("#maxstopmonth_id").val()+"&param_text="+$("#maxstopmonth").val());
		url(uri+"tuid="+$("#savecardcost_id").val()+"&param_text="+$("#savecardcost").val());
		url(uri+"tuid="+$("#savecard_id").val()+"&param_text="+$("#savecard").val());
		url(uri+"tuid="+$("#islimitday_id").val()+"&param_text="+ccms.util.getRadioValue("islimitday", "formedit1"));
		url(uri+"tuid="+$("#busyseasonstart_id").val()+"&param_text="+$("#busyseasonstart").val());
		url(uri+"tuid="+$("#isstopcarddays_id").val()+"&param_text="+ccms.util.getRadioValue("isstopcarddays", "formedit1"));
		url(uri+"tuid="+$("#stopcardmonthfee_id").val()+"&param_text="+$("#stopcardmonthfee").val());
		url(uri+"tuid="+$("#upgradeaddmoney_id").val()+"&param_text="+$("#upgradeaddmoney").val());
		url(uri+"tuid="+$("#changemembertype_id").val()+"&param_text="+ccms.util.getRadioValue("changemembertype", "formedit1"));
		url(uri+"tuid="+$("#uplimitday_id").val()+"&param_text="+$("#uplimitday").val());
		url(uri+"tuid="+$("#changememberfee_id").val()+"&param_text="+$("#changememberfee").val());
		ccms.dialog.alert("修改成功！");
	});

	function url(uri){
		ajaxCall(uri,{
	   		method: "get",
	   		progress: true,
	   		dataType: "script",
	   		success: function() {
	 		}
	 	});
	}
});
</script>
</body>
</html>