<!DOCTYPE html>
<html>

<head>
	${inc:/action/project/fitness/home/pub}
	<title>体验卡设置</title>
	<style type="text/css">
		.back {
			height: 36px;
			line-height: 36px;
			color: white !important;
			display: inline-block;
			background: rgb(33, 53, 64);
			border-radius: 4px;
			padding: 0px 20px;
			font-size: 14px;
		}

		#c_useremark {
			text-indent: 0;
		}

		#l_usedescr {
			white-space: pre-wrap;
		}

		.p-radio div {
			margin: 0 10px 0 30px;
		}

		p .iradio_square-blue {
			margin: 0 10px 0 30px;
			transform: scale(0.7,0.7);
		}
	</style>
</head>

<body style="font-size: 14px">
	<input  id="oldname" type="hidden" value="${fld:org_name}" />
	<input  id="oldphone" type="hidden" value="${fld:contact_phone}" />
	<input  id="oldaddress" type="hidden" value="${fld:address}" />


	<!-- 微信 -->
	<input name="status" id="status" type="hidden" value="" />
	<input name="m_startdate" id="m_startdate" type="hidden" value="${fld:startdate}" />
	<input name="m_enddate" id="m_enddate" type="hidden" value="${fld:enddate}" />

	<form id="messageForm" name="messageForm" method="post">
		<input type="hidden" id="c_code" name="c_code">
		<input name="m_code" id="m_code" type="hidden" value="${fld:code}" preserve="true">
		<div class="am-tabs r-tab-container weiChat   modal fade" id="modalAddnew" tabindex="-1" style="display:none;">
			<div class="dialogbg">
				<header class="header-default">
					<span id="formTitle">体验卡设置</span>
					<button type="button" class="header-close" data-dismiss="modal" aria-hidden="true"></button>
				</header>

				<div class="am-tabs-bd r-tab-cont ">
					<div class="wx-tab-cout-1 am-tab-panel am-in am-active am-fade three-none" id="wx-tab1">
						<div class="wx-1-left">
							<div class="wx-1-l-center">
								<div class="top">
									<header>
										<img src="${def:context}/js/project/fitness/image/common/bg1280.png" alt="">
										<span id="see_org_name"></span>
									</header>
									<p>
										电话：
										<span id="see_contact_phone"></span>
									</p>
									<p>
										地址：
										<span id="see_address">
										</span>
									</p>
									<div>
										<span id="l_cardname"></span>
										<img src="${def:context}/js/project/fitness/image/common/bg1280.png" alt="">
										<span>xxx</span>
										<span>xxxxxxxxxxxx</span>
										<p>前往会所出示此码，即可免费体验服务</p>
										<p id="l_date"></p>
									</div>
								</div>
								<div class="bot">
									<header>使用说明</header>
									<ul id="l_usedescr">
										<!-- 	<li>1、本券为贵宾券，仅限于在本店使用；</li>
											<li>2、本券不能与其他优惠券同时使用</li>
											<li>3、本券不能与其他优惠券同时使用</li>
											<li>4、本券不能与其他优惠券同时使用</li>
											<li>5、本券不能与其他优惠券同时使用</li> -->
									</ul>
								</div>
							</div>
						</div>

						<div class="wx-1-right">
							<header>
								<span>
									体验卡基本信息
								</span>
							</header>
							<ul>
								<li>
									<span>俱乐部名称：</span>
									<input type="text" id="c_name" name="c_name" value="" />
								</li>
								<li>
									<span>体验卡名称：</span>
									<input type="text" id="c_cardname" name="c_cardname" value="" />
								</li>
								<li>
									<span>电话：</span>
									<input type="text" id="c_contact_phone" name="c_contact_phone" value="" maxlength="80"
									    preserve="true" />
								</li>
								<li>
									<span>地址：</span>
									<input type="text" id="c_address" name="c_address" value="" maxlength="80">
								</li>
								<li>
									<span>体验卡类型：</span>
									<p class="p-radio" id="time_radio">
										<input type="radio" name="c_expertype" checked="checked" value="0" class="time_radio" />时效
										<input type="radio" name="c_expertype" checked="checked" value="1" class="time_radio" />记次
										<input type="radio" name="c_expertype" checked="checked" value="2" class="time_radio" />免费课
									</p>
								</li>
								<li>
									<span>使用限制：</span>
									<input type="text" id="c_experlimit" name="c_experlimit" value="" maxlength="80" />
									<span style="text-align: left;padding-left: 10px;" id="select_time">天/次/课时</span>
								</li>


								<li>
									<span>有效期：</span>
									<p class="p-radio">
										<p id="validatetypeone">
											<input type="radio" name="c_validatetype" checked="checked" value="0" />长期有效</p>
										<p id="validatetypetwo">
											<input type="radio" name="c_validatetype" checked="checked" value="1" />活动期间有效</p>
										<p id="validatetypethree">
											<input type="radio" name="c_validatetype" checked="checked" value="2" />指定时间有效</p>
									</p>
								</li>

								<li>
									<span></span>
									<input type="text" id="c_startdate" name="c_startdate" value="" maxlength="80" style="width: 150px" /> -
									<input type="text" id="c_enddate" name="c_enddate" value="" maxlength="80" style="width: 150px" />
								</li>


								<li>
									<span>启用状态：</span>
									<select id="c_status" name="c_status" class="input-default" disabled="disabled">
										<option value="2">未启用</option>
										<option value="1">启用</option>
										<option value="0">无效</option>
									</select>
								</li>

								<li class="sp">
									<span>使用说明：</span>
									<textarea id="c_useremark" name="c_useremark" cols="30" rows="10"></textarea>
								</li>
							</ul>
							<button id="save_btn" class="my-btn-default active" style='width:20%;margin-left:-57%'>保存</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>


	<nav class="back">
		<a href="#" id="back" style="color: white;font-size: 10px">&lt;&lt;活动列表</a>
	</nav>
	<form role="form" method="post" id="searchForm">
		<input name="sort" type="hidden" value="created" preserve="true" />
		<input name="order" type="hidden" value="desc" preserve="true" />
		<input name="pageNo" type="hidden" value="" preserve="true" />
		<input name="totalPages" type="hidden" value="" preserve="true" />
		<input type="hidden" id="s_code" name="s_code" value="${fld:code}">
		<div class="r-tab-cont">
			<div class="c-n-nav-2 am-tab-panel am-in am-active am-fade three-none">
				<div class="r-tab-cout-3-t">
					<div class="r-tab-cout-3-t-t">
						<nav>
							<li class="w-200">
								<input id="s_name" name="s_name" type="text" class="input-default" placeholder="卡名称" />
							</li>

							<li>
								<div class="my-selected">
									<select id="s_status" name="s_status" class="normal-select">
										<option value="">全部状态</option>
										<option value="0">无效</option>
										<option value="1">启用</option>
										<option value="2">未启用</option>
									</select>
								</div>
							</li>
							<div class="r-c-btnList">
								<button type="button" class="r-c-3-btn-1" id="search_btn"></button>
								<img src="${def:context}/js/project/fitness/image/SVG/nav/xinzengkecheng.svg" alt="" data-toggle="modal" id="addnew_btn">
							</div>
						</nav>
					</div>

					<div class="tab-cout-nav-b">
						<nav class="r-c-3-t-b-l">

						</nav>
						<nav class="r-c-3-t-b-r">
							<li>
								<img src="${def:context}/js/project/fitness/image/SVG/nav/yulan.svg" alt="" id="see_btn">
							</li>
							<li>
								<img src="${def:context}/js/project/fitness/image/SVG/btn/kaiqi.svg" title='启用' alt="" id="start_btn">
							</li>
							<li>
								<img src="${def:context}/js/project/fitness/image/SVG/btn/jinyong.svg" title='禁用' alt="" id="disable_btn">
							</li>
							<li>
								<img src="${def:context}/js/project/fitness/image/SVG/nav/xiugai.svg" alt="" id="edit_btn">
							</li>
							<li>
								<img src="${def:context}/js/project/fitness/image/SVG/nav/shanchu.svg" alt="" id="delete_btn">
							</li>
						</nav>
					</div>
				</div>
				<!-- 通用表格 -->
				<div class="r-tab-cout-3-b">
					<div class="to-change-background h-43"></div>
					<table>
						<thead>
							<tr>
								<th class="table-checkbox">
									<label class="am-checkbox">
										<input id="selectAll" name="datalist" type="checkbox" value="" style="display: none;">
									</label>
								</th>
								<th>体验卡名称</th>
								<th>体验卡类型</th>
								<th>使用限制</th>
								<th>有效期</th>
								<th>卡状态</th>
							</tr>
						</thead>

						<tbody id="datagridTemplate" style="display: none">
							<tr>
								<td class="table-checkbox">#application_id#</td>
								<td>#name#</td>
								<td>#cardtype#</td>
								<td>#experlimit#</td>
								<td>#validatetype#</td>
								<td>#status#</td>
							</tr>
						</tbody>
						<tbody id="datagrid">
						</tbody>
					</table>
					<div class="pageDiv">
						<ul class="pagination">
						</ul>
					</div>
				</div>
			</div>
		</div>
	</form>
	<input type="hidden" name="actionroot" id="actionroot" value="${def:actionroot}" />
	<script language="JavaScript">
		var search = null;
		$(document).ready(function () {
			if ("${fld:validatetype}" == "0") {
				$("#validatetypetwo").hide();
			} else if ("${fld:validatetype}" == "1") {
				$("#validatetypeone").hide();
			}

			$('input[name=c_validatetype]:eq(0)').on("ifChecked", function () {
				$('#l_date').text('有效期: 无限制');
				$("#c_startdate,#c_enddate").val('');
				$("#c_startdate,#c_enddate").attr("disabled", true);
			})

			$('input[name=c_validatetype]:eq(1)').on("ifChecked", function () {
				$("#c_startdate,#c_enddate").attr("disabled", true);
				if ($("#m_startdate").val() != "") {
					$("#c_startdate").val($("#m_startdate").val());
					$("#c_enddate").val($("#m_enddate").val());
					$('#l_date').text('有效期:' + $("#c_startdate").val() + '至' + $("#c_enddate").val());
				} else {
					$("#c_startdate,#c_enddate").val('');
					$('#l_date').text('有效期: 无限制');
				}
			});
			$('input[name=c_validatetype]:eq(2)').on("ifChecked", function () {
				$("#c_startdate,#c_enddate").attr("disabled", false);
			});
			//页面点击事件
			$(document).click(function () {
				$(".error").html("");
			});

			searchSelectInit($("#c_status,#s_status"));
			$Dialog().date($('#c_startdate'));
			$Dialog().date($('#c_enddate'), function () {
				if ($("#c_startdate").val() != '') {
					$('#l_date').text('有效期:' + $("#c_startdate").val() + '至' + $("#c_enddate").val());
				}
			});
			$(".header-close").unbind().on("click", function () {
				$("#modalAddnew").modal('hide');
				ccms.util.clearForm('messageForm');
			});
			//批量启用
			$("#start_btn").unbind().on("click", function () {
				updateStatus(1);
			});
			//批量禁用
			$("#disable_btn").unbind().on("click", function () {
				updateStatus(2);
			});
			//给左侧赋值

		 	$("#c_cardname").unbind().on("blur", function () {
				$('#l_cardname').text($("#c_cardname").val());
			});



			var obj = $Crud({
				formId: "messageForm",
				button: "save_btn",
				bpkField: "c_code",
				insertBack: function () {
					search.searchData();
				},
				updateBack: function () {
					search.searchData();
				},
				deleteBack: function () {
					search.searchData();
				},
				addNewBack: function () {
					$("#formTitle").html("新增");
					setSelectValue($('#c_status'), "2");
					$('#save_btn').show();
					$(".color").removeAttr("style");
					$('#foot').show();
					
					$('#c_name').val($('#oldname').val());
					$('#c_contact_phone').val($('#oldphone').val());
					$('#c_address').val($('#oldaddress').val());
					
					$('#see_org_name').text($('#oldname').val());
					$('#see_contact_phone').text($('#oldphone').val());
					$('#see_address').text($('#oldaddress').val());
					clearnForm();
				},
				editBack: function () {},
				validate: function () {
					if ($("input[name=c_covertype]:checked").val() == 1) {
						$('#c_covervalue').val($('#c_img').val());
					} else {
						$('#c_covervalue').val($('#color').val());
					}
					var flag = $("#messageForm").validate({});
					return flag;
				}
			}).init();


			this.search = search;
			search = $Search({
				datagrid: "datagrid",
				formId: "searchForm",
				rowpackage: function (obj) {
					if (obj.status == "已启用") {
						$('#status').val(1);
					}
				},
				success: function () {
					ccms.util.renderCheckbox("datalist");
					//全选   取消全选
					$("#selectAll").unbind().on("ifChecked", function () { //点击事件未选中
						$('input[name=datalist]').iCheck('check'); //
					}).on("ifUnchecked", function () { //点击事件未选中
						$('input[name=datalist]').iCheck('uncheck'); //
					});

					$("#edit_btn").unbind().on("click", function () {
						var obthis = getCheckboxValue("datalist");
						var len = $('input[name=datalist]:checked').length
						if (obthis != "" && len == 1) {
							ccms.util.clearForm('messageForm');
							$('#formTitle').text('修改');
							$('#save_btn').show();
							obj.edit({
								id: obthis
							});
						} else {
							ccms.dialog.notice("请选择一个体验卡！")
						}
					});

					$("#see_btn").unbind().on("click", function () {
						var obthis = getCheckboxValue("datalist");
						var len = $('input[name=datalist]:checked').length
						if (obthis != "" && len == 1) {
							ccms.util.clearForm('messageForm');
							$('#save_btn').hide();
							obj.edit({
								id: obthis
							});
							$('#formTitle').html('查看');
						} else {
							ccms.dialog.notice("请选择一个体验卡！")
						}
					});

					
					
					$('#c_name').bind('input propertychange', function() {  
						$('#see_org_name').text($('#c_name').val());
					});  

					$('#c_contact_phone').bind('input propertychange', function() {  
						$('#see_contact_phone').text($('#c_contact_phone').val());
					});  
					
					$('#c_address').bind('input propertychange', function() {  
						$('#see_address').text($('#c_address').val());
					});  
					
					
					$('#c_useremark').bind('input propertychange', function() {  
						$('#l_usedescr').html($("#c_useremark").val());
					});  
					
					
					
					/* 		$("#edit_btn").unbind().on("click", function(){
								var obthis = getCheckboxValue("datalist");
								var len=$('input[name=datalist]:checked').length
								if(obthis!=""&&len==1){
									ccms.util.clearForm('messageForm');
									clearnForm();
									$('#foot').show();
									obj.edit({id:obthis});
								}else{
									ccms.dialog.notice("请选择一个活动卡！")
								}
							});	
							
							$("#see_btn").unbind().on("click", function(){
								var obthis = getCheckboxValue("datalist");
								var len=$('input[name=datalist]:checked').length
								if(obthis!=""&&len==1){
									ccms.util.clearForm('messageForm');
									clearnForm();
									$('#foot').hide();
									obj.edit({id:obthis});
								}else{
									ccms.dialog.notice("请选择一个活动卡！")
								}
							});	 */
					$(".time_radio").on("ifChecked", function () {
						if (this.value == '0') {
							$('#select_time').text('天');
						} else if (this.value == '1') {
							$('#select_time').text('次');
						} else {
							$('#select_time').text('课时');
						}


					});


					$("#delete_btn").unbind().on("click", function () {
						var flag = true;
						var obthis = getCheckboxValue("datalist");

						var checkObj = $('input[name=datalist]:checked');
						$(checkObj).each(function () {
							if ($(this).attr('code') == 1) {
								flag = false;
							}
						})

						if (flag) {
							if (obthis != "") {
								$Dialog().confirm("确定要执行此操作吗?", function () {
									obj.del({
										id: obthis
									});
								});
							} else {
								ccms.dialog.notice("请选择体验卡！");
							}
						} else {
							ccms.dialog.notice("不能删除已启用体验卡！");
						}
					});
				}
			}).initSearchBtn().searchData(1);







		})

		function clearnForm() {
			$('#l_cardname').text('');
			$('#l_descr').text('');
			$('#l_date').text('');
			$('#l_usedescr').text('');
		}


		function updateStatus(num) {
			var obthis = getCheckboxValue("datalist");
			if (obthis != "") {
				$Dialog().confirm("确定要进行此操作吗?", function () {
					if (num == 1) {
						if ($('#status').val() == 1) {

							ccms.dialog.notice("同时只能开启一个体验卡");
							return false;
						}
					}


					var url = "${def:context}${def:actionroot}/updatestatus?id=" + obthis + "&c_status=" + num + "&code=${fld:code}";
					ajaxCall(url, {
						method: "get",
						progress: true,
						dataType: "script",
						success: function () {
							ccms.dialog.notice("操作成功！");
							search.searchData(1);
						}
					});
				});
			} else {
				ccms.dialog.notice("请选体验卡！")
			}
		}

		$('#back').on('click', function () {
			location.href = "${def:context}/action/project/fitness/basic/marketcampaign/crud";
		})
	</script>
</body>

</html>