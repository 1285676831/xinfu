<!DOCTYPE html>
<html>
<head>
${inc:/action/project/fitness/home/pub}
<script src="${def:context}/js/echarts-2.2.7/build/dist/echarts.js" type="text/javascript"></script>
<script src="${def:context}/js/project/fitness/js/report/base-charts.js" type="text/javascript"></script>
<title>客流分析</title>
</head>
<body>
	<div class="am-tabs-bd r-tab-cont">
		<div class="bb-tab-cout-2 bb-tab-cout-8 am-active three-none" id="bb-tab8">
			<div class="tab-cout-nav f-s-t">
				<div class="f-s-t-top">
					<div>
						<header>入场人数</header>
						<span class="count" id="todayinleft"></span>
						<p>
							环比 <span id="premonthinleft"></span> 
							<i id="premonthinleftrate"></i></p>
						<span class="countLast">本月: <i id="monthinleft"></i>人次
						</span>
					</div>
					<div>
						<header>资源到访人数</header>
						<span class="count" id="todayvisit"></span>
						<p>
							环比 <span id="premonthvisit"></span>
							<i id="premonthvisitrate"></i>
						</p>
						<span class="countLast">本月: <i id="monthvisit"></i>人次
						</span>
					</div>
					<div>
						<header>资源陌生到访人数</header>
						<span class="count" id="todayms"></span>
						<p>
							环比 <span id="premonthms"></span>
							<i id="premonthmsrate"></i>
						</p>
						<span class="countLast">本月: <i id="monthmsnum"></i>人次
						</span>
					</div>
					<div>
						<header>资源预约到访人数</header>
						<span class="count" id="todayyy"></span>
						<p>
							环比 <span id="premonthyy"></span>
							<i id="premonthyyrate"></i>
						</p>
						<span class="countLast">本月: <i id="monthyynum"></i>人次
						</span>
					</div>
					<div>
						<header>私教签课节数</header>
						<span class="count" id="todaypt"></span>
						<p>
							环比 <span id="premonthpt"></span> 
							<i id="premonthptrate"></i>
						</p>
						<span class="countLast">本月: <i id="monthpt"></i>人次
						</span>
					</div>
					<div>
						<header>团操上课人数</header>
						<span class="count" id="todayclass"></span>
						<p>
							环比 <span id="premonthclass"></span> 
							<i id="premonthclassrate"></i>
						</p>
						<span class="countLast">本月: <i id="monthclass"></i>人次
						</span>
					</div>
				</div>
				
				<div class="tab-cout-nav-t">
					<nav class="tab-nav-my">
						<li class="dateTime "><input type="text" id="fdate" name="fdate" value="" class="input-default" /></li>
						<li class="dateTime "><input type="text" id="tdate" name="tdate" value="" class="input-default" /></li>
						<li>
							<div class="my-selected">
								<select class="normal-select" id="datatype" name="datatype">
									<option value="0" selected>按天</option>
									<option value="1">按周</option>
									<option value="2">按月</option>
								</select>
							</div>
						</li>
						<button id="searchAll" class="freshen">刷新</button>
					</nav>
				</div>
			</div>
			
			<div class="bb-2-bottom">
				<div class="bb-2-b-t">
					<div class="addTop" code="chartsgroup" data-area="inleft">
						<header>
							<span>入场客流</span>
							<nav>
							<li id="inlefttongbi" name="inlefttongbi" data-name="compareflag" data-area1="0" data-area="inleft" data-code="T">同比</li>
							<li id="inlefthuanbi" name="inlefthuanbi" data-name="compareflag" data-area1="0" data-area="inleft" data-code="H">环比</li>
								<li>
									<div class="my-selected">
										<select class="normal-select" id="inleftdatatype" name="inleftdatatype" data-name="datatype" data-area="inleft">
											<option value="0" selected>按天</option>
											<option value="1">按周</option>
											<option value="2">按月</option>
										</select>
									</div>
								</li>
							</nav>
						</header>
						<nav>
							<div class="nav-li-group">
								<li class="dateTime small"><input type="text" id="inleftfdate" name="inleftfdate" value="" class="input-default" /></li>
								<li class="dateTime small"><input type="text" id="inlefttdate" name="inlefttdate" value="" class="input-default" /></li>
							</div>
							<li>
								<button data-area="inleft" data-type="bar" name="changeMagicType"></button>
								<button data-area="inleft" data-type="line" name="changeMagicType" class="active"></button>
								<button data-area="inleft" data-type="list" name="changeMagicType"></button>
							</li>
						</nav>
						<div><p id="inleftdaterangespan"></p></div>
						<div id="inleftDiv" class="other-full"></div>
					</div>
					<div class="addTop" code="chartsgroup" data-area="ptclass">
						<header>
							<span>私教团操上课</span>
							<nav>
							<li id="ptclasstongbi" name="ptclasstongbi" data-name="compareflag" data-area1="1" data-area="ptclass" data-code="T">同比</li>
							<li id="ptclasshuanbi" name="ptclasshuanbi" data-name="compareflag" data-area1="1" data-area="ptclass" data-code="H">环比</li>
								<li>
									<div class="my-selected">
										<select class="normal-select" id="ptclassdatatype" name="ptclassdatatype" data-name="datatype" data-area="ptclass">
											<option value="0" selected>按天</option>
											<option value="1">按周</option>
											<option value="2">按月</option>
										</select>
									</div>
								</li>
							</nav>
						</header>
						<nav>
							<div class="nav-li-group">
								<li class="dateTime small"><input type="text" id="ptclassfdate" name="ptclassfdate" value="" class="input-default" /></li>
								<li class="dateTime small"><input type="text" id="ptclasstdate" name="ptclasstdate" value="" class="input-default" /></li>
							</div>
							<li>
								<button data-area="ptclass" data-type="bar" name="changeMagicType"></button>
								<button data-area="ptclass" data-type="line" name="changeMagicType" class="active"></button>
								<button data-area="ptclass" data-type="list" name="changeMagicType"></button>
							</li>
						</nav>
						<div><p id="ptclassdaterangespan"></p></div>
						<div id="ptclassDiv" class="other-full"></div>
					</div>
				</div>
				<article class="r-tab-cout-3-b">
					<form role="form" method="post" id="searchForm" class="disNone">
						<input name="sort" type="hidden" value="" preserve="true" />
						<input name="order" type="hidden" value="" preserve="true" />
						<input name="pageNo" type="hidden" value="" preserve="true" />
						<input name="totalPages" type="hidden" value="" preserve="true" />
						<input id="listfdate" name="listfdate" type="hidden" value="" preserve="true" />
						<input id="listtdate" name="listtdate" type="hidden" value="" preserve="true" />
					</form>
					<div class="to-change-background"></div>
					<table class="am-table">
						<thead>
							<tr>
								<th>时间</th>
								<th colspan="2">入场人数</th>
								<th colspan="2">私教</th>
								<th colspan="2">团操</th>
							</tr>
							<tr>
								<th></th>
								<th>资源到访</th>
								<th>会员入场</th>
								<th>预约</th>
								<th>签课</th>
								<th>预约</th>
								<th>上课</th>
							</tr>
						</thead>
						<tbody id="datagridTemplate" style="display: none">
							<tr>
								<td>#createdate#</td>
								<td>#visitnum#</td>
								<td>#inleftnum#</td>
								<td>#ptpreparenum#</td>
								<td>#ptnum#</td>
								<td>#clspreparenum#</td>
								<td>#clsnum#</td>
							</tr>
						</tbody>
						<tbody id="datagrid">
						</tbody>
					</table>
					<div class="pageDiv">
						<ul class="pagination">
						</ul>
					</div>
				</article>
			</div>
		</div>
	</div>

	<input type="hidden" name="actionroot" id="actionroot" value="${def:actionroot}" />
</body>
<script type="text/javaScript">
var chartsObj = [];
$(document).ready(function() {
	chartsUri = ["${def:actionroot}/queryinleft", "${def:actionroot}/queryptclass"];
	
	ccms.dialog.date($("#fdate,#tdate"));
	$("#fdate").val(new Date().format("yyyy-MM-01"));
	$("#tdate").val(new Date().format("yyyy-MM-dd"));
	selectInit($("#datatype"), "100px");
	// 循环图表
	$("div[code=chartsgroup]").each(function(i,ele){
		var darea = $(this).data("area");
		// 初始化筛选条件
		$("#"+darea+"fdate").val(new Date().format("yyyy-MM-01"));
		$("#"+darea+"tdate").val(new Date().format("yyyy-MM-dd"));
		$("#"+darea+"fdate,#"+darea+"tdate").attr("data-idx", i);
		//selectInit($("#"+darea+"datatype"), "70px");
		// 选择区域日期后刷新区域charts
		ccms.dialog.date($("#"+darea+"fdate"), function(){
			refreshCharts($("#"+darea+"fdate").data("idx"));
		});
		ccms.dialog.date($("#"+darea+"tdate"), function(){
			refreshCharts($("#"+darea+"fdate").data("idx"));
		});
		// 初始化charts
		var obj = new chartsClass();
		obj.init({idx: i, isLegendShow: true, dataArea: darea, uri: chartsUri[i]});
		chartsObj[i] = obj;
	});
	
	/** 同比、环比 */
	$("li[data-name=compareflag]").on("click",function(){
		if($(this).hasClass('baobiao-active')){
			$(this).removeClass("baobiao-active");
		}else{
			$(this).siblings().removeClass("baobiao-active");
			$(this).addClass("baobiao-active");
		}
		var dataarea = $(this).attr("data-area1");
		refreshSingleCharts(dataarea);
	});
	
	/** 各图表区域日期变更事件 */
	$("input[data-name=fdate],input[data-name=tdate]").each(function(idx,ele){
		ccms.dialog.date($(ele), function(){
			var dataarea = $(ele).attr("data-area");
			refreshSingleCharts(dataarea);
		});
	});

	// 搜索列表
	var search = $Search({datagrid:"datagrid", formId:"searchForm", rowpackage:function(obj){
	},success:function(){
	}}).initSearchBtn();
	
	$("#searchAll").unbind().on("click",function(){
		$("#inleftDiv,#ptclassDiv").html("");
		// 顶部统计
		getAjaxCall("${def:actionroot}/querytotal", true);
		// 循环加载图表
		$("div[code=chartsgroup]").each(function(k,ele){
			var darea = $(this).data("area");
			// 顶部搜索条件同步
			$("#"+darea+"fdate").val($("#fdate").val());
			$("#"+darea+"tdate").val($("#tdate").val());
			$("#"+darea+"datatype").val($("#datatype").val());
			// 加载charts
			var obj = chartsObj[k];
			obj.loadCharts();
		});

		$("#listfdate").val($("#fdate").val());
		$("#listtdate").val($("#tdate").val());
		search.searchData(1);
	});
	$("#searchAll").click();
});

/** 刷新单个图表 */
function refreshSingleCharts(dataarea){
	refreshCharts(dataarea);
}
function refreshCharts(idx){
	var obj = chartsObj[idx];
	obj.loadCharts();
}
</script>
</body>
</html>